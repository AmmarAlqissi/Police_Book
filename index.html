<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>كتيب الشرطة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Application Structure Plan: 
        - Layout: Two-column layout. Left fixed sidebar for navigation based on the "الفهرس". Right column for content display.
        - Header: Application title, a global search bar, and a section-specific search bar.
        - Content Display: Each section from the booklet is a view in the right column. Sub-sections use headings and lists. Collapsible accordions for dense information.
        - Interactivity: Sidebar navigation, global search with results list and navigation to specific occurrences, section-specific search with highlighting, Chart.js for "أعداد الشرطة في السرقات", HTML/CSS diagram for "سلم الصلاحيات", and four new LLM-powered features: "Quick Consultation", "Scenario Analysis", "Training Question Generator", and "Draft Report Generator".
        - User Flow: Land on page (first section visible) -> Navigate via sidebar -> Use global search to find content across booklet with direct jump to occurrences -> Use section search for in-depth look -> Expand/collapse details -> Use LLM for quick consultation, scenario analysis, training questions, or report drafting.
        - Why this structure?: Familiar navigation for manuals, organized, scalable, focused content view, with added AI utility and enhanced search capabilities for practical application and training.
    -->
    <!-- Visualization & Content Choices:
        - الفهرس -> Sidebar Navigation (HTML list, JS for content switching). Goal: Navigate. Justification: Standard.
        - Text Sections -> Formatted text, collapsible accordions (HTML, JS). Goal: Inform, Detail. Justification: Readability.
        - 2.1.3 أعداد الشرطة في السرقات -> Horizontal Bar Chart (Chart.js). Goal: Compare, Inform. Justification: Visual comparison of staffing.
        - 3.0 أولوية التعامل مع الحالات -> Styled HTML sections (HTML, Tailwind). Goal: Inform, Categorize. Justification: Clear structure.
        - 3.1 سلم الصلاحيات -> HTML/CSS Diagram (Nested divs, Tailwind). Goal: Organize, Inform. Justification: Visual hierarchy.
        - Global Search -> New input field, JS for searching all contentData, displaying results as clickable links with snippets, and direct navigation/highlighting/scrolling to occurrences. Goal: Explore, Find. Justification: Provides comprehensive and precise search across the entire document.
        - Section-specific Search -> Existing input field, JS for highlighting in active section. Goal: Refine search within current view. Justification: Allows focused search.
        - استشارة سريعة (LLM Feature) -> Text input, button, text output (HTML, JS, Gemini API). Goal: Consult, Generate insights. Justification: Provides AI-powered assistance based on the booklet's context.
        - تحليل السيناريوهات (LLM Feature) -> Textarea for scenario, button, text output (HTML, JS, Gemini API). Goal: Apply knowledge, Role-play, Problem-solve. Justification: Allows users to test understanding of SOPs in practical situations.
        - اقتراح أسئلة تدريبية (New LLM Feature) -> Dropdown for section, button, text output (HTML, JS, Gemini API). Goal: Self-assessment, Training. Justification: Facilitates learning and retention of SOPs.
        - صياغة تقرير مبدئي (New LLM Feature) -> Textarea for incident details, button, text output (HTML, JS, Gemini API). Goal: Practical application, Report drafting aid. Justification: Assists in applying SOPs to real-world (game) incidents.
        - Background Decoration -> Subtle background image on body. Goal: Aesthetic, Thematic. Justification: Enhances visual appeal without distracting.
        - Police Themed Header Image -> Prominent placeholder image at the top of the main content. Goal: Aesthetic, Thematic. Justification: Visually reinforces the police theme.
    -->
    <style>
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f1f5f9; /* slate-100 as fallback */
            background-image: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="100" height="100" fill="%23f1f5f9"/><path d="M 0 0 L 50 0 L 0 50 Z M 100 100 L 50 100 L 100 50 Z" fill="%23e2e8f0" opacity="0.5"/><path d="M 0 50 L 50 100 L 100 50 L 50 0 Z" fill="%23cbd5e1" opacity="0.3"/></svg>');
            background-size: 100px 100px; /* Adjust size for subtlety */
            background-repeat: repeat;
            opacity: 1; /* Ensure body opacity is 1 */
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .sidebar-link.active {
            background-color: #0284c7; /* sky-600 */
            color: white;
        }
        .accordion-button::after {
            content: '+';
            float: left;
            margin-left: 5px;
        }
        .accordion-button.open::after {
            content: '-';
        }
        mark {
            background-color: #fde047; /* yellow-400 */
            padding: 0.1em;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            height: auto; /* Adjusted for dynamic content */
            min-height: 300px; /* Minimum height */
            max-height: 500px; /* Maximum height */
        }
        /* RTL adjustments for accordion icon */
        html[dir="rtl"] .accordion-button::after {
            float: right;
            margin-left: 0;
            margin-right: 5px;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid #0284c7; /* sky-600 */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">
    <div class="flex flex-col md:flex-row min-h-screen">
        <aside id="sidebar" class="w-full md:w-72 bg-slate-800 text-slate-100 p-4 space-y-2 fixed md:sticky top-0 h-screen overflow-y-auto transition-transform transform md:translate-x-0 -translate-x-full z-20">
            <button id="close-sidebar-btn" class="md:hidden text-white absolute top-4 left-4 text-2xl">&times;</button>
            <h2 class="text-xl font-semibold mb-4">الفهرس</h2>
            <nav id="toc-nav">
                </nav>
        </aside>

        <main class="flex-1 p-4 md:p-8 overflow-y-auto">
            <header class="mb-6 flex flex-col sm:flex-row justify-between items-center">
                <div class="flex items-center">
                    <button id="menu-toggle-btn" class="md:hidden text-slate-800 text-2xl mr-4">&#9776;</button>
                    <h1 class="text-2xl sm:text-3xl font-bold text-sky-700">كتيب إجراءات الشرطة التفاعلي</h1>
                </div>
                <div class="mt-4 sm:mt-0 w-full sm:w-auto flex flex-col sm:flex-row gap-2">
                    <input type="text" id="global-search-input" placeholder="ابحث في الكتيب كاملاً..." class="p-2 border border-slate-300 rounded-md w-full sm:w-64 focus:ring-sky-500 focus:border-sky-500">
                    <input type="text" id="section-search-input" placeholder="ابحث في القسم الحالي..." class="p-2 border border-slate-300 rounded-md w-full sm:w-64 focus:ring-sky-500 focus:border-sky-500">
                </div>
            </header>

            <div class="mb-6 rounded-lg overflow-hidden shadow-lg">
                <img src="https://placehold.co/1200x200/0f172a/cbd5e1?text=Storm+City+Police+Department" alt="Police Department Banner" class="w-full h-auto object-cover">
            </div>

            <div id="global-search-results" class="bg-blue-50 p-4 rounded-lg shadow-md mb-6 hidden">
                <h3 class="text-lg font-semibold text-blue-700 mb-2">نتائج البحث العام:</h3>
                <ul id="global-results-list" class="list-disc list-inside space-y-2">
                    </ul>
                <button id="clear-global-search" class="mt-3 bg-blue-500 hover:bg-blue-600 text-white text-sm py-1 px-3 rounded">مسح البحث العام</button>
            </div>

            <div id="content-area">
                </div>
        </main>
    </div>

    <script>
        const toc = [
            { id: "intro", title: "مقدمة الكتيب" },
            { id: "s1_0", title: "1.0 قواعد الشرطة" },
            { id: "s1_1", title: "1.1 التعريفات" },
            { id: "s1_2", title: "1.2 حقوق الشرطة" },
            { id: "s1_3", title: "1.3 آلية التعامل مع الحالات الجنائية" },
            { id: "s1_4", title: "1.4 بروتوكولات التعامل بين شرطي و شرطي" },
            { id: "s1_5", title: "1.5 انضباط الشرطة" },
            { id: "s1_6", title: "1.6 قواعد سلوكيات تعامل الشرطة مع المواطنين" },
            { id: "s1_7", title: "1.7 قواعد وسلوكيات التعامل مع مجرم أو مشتبه" },
            { id: "s1_8", title: "1.8 قواعد وسلوكيات التعامل مع الحالات" },
            { id: "s1_9", title: "1.9 قواعد وسلوكيات التعامل مع المطاردة" },
            { id: "s2_0", title: "2.0 بروتوكولات التفاوض" },
            { id: "s2_1", title: "2.1 أحكام أخرى للسرقات" },
            { id: "s2_2", title: "2.2 حقوق المواطنين" },
            { id: "s2_3", title: "2.3 قواعد وسلوكيات التعامل مع أفراد الطاقم الطبي" },
            { id: "s2_4", title: "2.4 قواعد وسلوكيات عامة" },
            { id: "s2_5", "title": "2.5 قواعد وسلوكيات المجرمين" },
            { id: "s2_6", title: "2.6 الأسلحة والذخائر" },
            { id: "s2_7", title: "2.7 ترخيص استخدام الأسلحة للمواطنين" },
            { id: "s2_8", title: "2.8 بروتوكولات وقوانين التقاعد" },
            { id: "s2_9", title: "2.9 التحذيرات و المحاسبات" },
            { id: "s3_0", title: "3.0 أولوية التعامل مع الحالات" },
            { id: "s3_1", title: "3.1 سلم الصلاحيات" }, 
            { id: "llm_consultation", title: "استشارة سريعة ✨" },
            { id: "scenario_analysis", title: "تحليل السيناريوهات ✨" },
            { id: "training_questions", title: "اقتراح أسئلة تدريبية ✨" }, // New LLM feature
            { id: "draft_report", title: "صياغة تقرير مبدئي ✨" } // New LLM feature
        ];

        const contentData = {
            "intro": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">مقدمة الكتيب</h2>
                    <p class="mb-4">مرحباً بك في النسخة التفاعلية من كتيب إجراءات التشغيل القياسية لشرطة سان أندرياس - قسم شرطة Storm City. يهدف هذا الكتيب إلى توفير مرجع شامل وواضح لجميع القواعد والبروتوكولات والإجراءات التي يجب على أفراد الشرطة اتباعها لضمان تطبيق القانون وحماية المواطنين والممتلكات بكفاءة ومهنية عالية.</p>
                    <p class="mb-4">تم تصميم هذا التطبيق لتسهيل الوصول إلى المعلومات واستعراضها بشكل تفاعلي. يمكنك التنقل بين الأقسام المختلفة باستخدام الفهرس الجانبي، والبحث عن مصطلحات محددة، واستكشاف بعض البيانات بشكل مرئي.</p>
                    <div class="mt-6 p-4 bg-sky-50 border-r-4 border-sky-500 rounded">
                        <h3 class="text-lg font-semibold text-sky-600 mb-2">شعار القسم:</h3>
                        <p class="text-xl font-medium">"To protect and to serve"</p>
                        <p class="mt-1 text-sm text-slate-600">(للحماية والخدمة)</p>
                    </div>
                </div>
            `,
            "s1_0": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">1.0 قواعد الشرطة</h2>
                    <p class="mb-4">شرطة لوس سانتوس تهدف لحماية النظام الأمني القومي والنظام العام وممتلكات ومناطق مدينة لوس سانتوس، وحماية المواطنين هي أولى اهتماماتنا. وعلى الشرطي تنبؤ التعامل مع الحالات بالشكل الذي يناسب هيئته كشرطي وتبعاً لكتيب بروتوكولات الشرطة. تمثل الشرطة السلطة التنفيذية للقانون في المجتمع، وتعمل على تطبيق الأنظمة والتشريعات المحلية والوطنية. يعمل أفراد الشرطة على حماية المواطنين والممتلكات، ومنع الجرائم والمخالفات، وتحقيق العدالة في حالات الانتهاكات للقانون.</p>
                    <h3 class="text-xl font-semibold text-sky-600 mt-4 mb-2">1. قواعد وسلوكيات التعامل</h3>
                    <p>قواعد وسلوكيات التعامل تمثل هيئة الشرطة بشكل عام أمام المجتمع من ناحية الإجراءات والحماية والتنفيذ، وطرق التعامل في الآلية التي تبرز هيئة الشرطة من طرف عناصر الشرطة.</p>
                </div>
            `,
            "s1_1": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">1.1 التعريفات</h2>
                    <p class="mb-4">هذا القسم يوضح المصطلحات الأساسية المستخدمة في هذا الكتيب لضمان فهم موحد للإجراءات والقوانين. فهم هذه التعريفات ضروري لجميع أفراد الشرطة لتطبيق البروتوكولات بشكل صحيح وفعال.</p>
                    <ul class="space-y-3 list-inside">
                        <li><strong>1. المشتبه به:</strong> مواطن يشتبه في تورطه بجريمة جنائية، ويتصف عادةً بـ:
                            <ol class="list-decimal list-inside pr-6 mt-1 space-y-1">
                                <li>ارتداء ملابس مثيرة للاشتباه (قناع، حامل سلاح، درع مضاد للرصاص).</li>
                                <li>وجوده قرب موقع الجريمة.</li>
                                <li>وجود دافع لديه لارتكاب الجريمة.</li>
                                <li>إدلائه بتصريحات غير مباشرة تشير للجريمة.</li>
                            </ol>
                        </li>
                        <li><strong>2. المجرمون:</strong> أشخاص قاموا بتنفيذ أعمال إجرامية وثبتت عليهم.</li>
                        <li><strong>3. حقوق ميراندا:</strong> حقوق تمنح للمشتبه به أثناء التحقيق أو القبض، تتضمن الحق في الصمت، وأن أي شيء يقوله قد يستخدم ضده في المحكمة، وحق الحصول على محامٍ. وتكون كالتالي: (تم القبض عليك من شرطة Storm City بتهمة [نوع التهمة]. يحق لك التزام الصمت، أي شيء تقوله يستخدم ضدك في المحكمة، كما يحق لك توكيل محامٍ، وفي حال عدم قدرتك على توكيل محامٍ، توفر لك الولاية محامياً إن وجد).</li>
                        <li><strong>4. القوة المعقولة:</strong> استخدام القوة الضرورية والمناسبة للموقف لتأمين الانضباط وفرض القانون، مثل الصعق الكهربائي أو الضرب باليد للدفاع عن النفس أو لتقييد المخالف بما يتناسب مع خطورة الموقف ودون تجاوز الحدود.</li>
                        <li><strong>5. القوة المفرطة:</strong> استخدام القوة الزائدة، بما في ذلك السلاح الناري مباشرة، في حال وجود خطر يهدد الحياة فورياً.</li>
                        <li><strong>6. مركز العمليات:</strong> يدير وينسق جميع الأنشطة والعمليات اليومية لوحدات الشرطة، يتلقى البلاغات، ويتخذ القرارات لتوجيه وتنسيق الفرق الميدانية والموارد للاستجابة السريعة للحوادث والطوارئ. وهو المحور الأساسي لتنظيم الوحدات وتوزيعها وتوجيهها للحالات والتأكد من العدد وتعيين مسؤول للحالات.</li>
                        <li><strong>7. مسؤول الفترة:</strong> الرتبة الأعلى في الميدان (Officer III فأعلى). يشرف على الحالات ويكتب الملاحظات والأخطاء (إن وجدت) ويقدمها للشؤون الداخلية. كما يوجه ويرشد من أخطأ، ويستجيب لطلبات المواطنين التي لا يستطيع الشرطي الأقل رتبة التعامل معها. إذا لم يستطع حل مشكلة المواطن، يطلب منه التوجه لرفع شكوى رسمية.</li>
                        <li><strong>8. مسؤول الحالة:</strong> يعينه مسؤول الفترة أو يكون مسؤول الفترة نفسه. إذا لم يوجد مسؤول فترة، يعينه Dispatch. يفضل أن يكون الرتبة الأعلى في الميدان.
                            <p class="mt-1 pl-6">مهامه: تنظيم ترتيب الوحدات في الموقع، اختيار المفاوض المناسب (في حال وجود رهينة)، وتقييم المعدات المناسبة للحالة (عدد الوحدات الأرضية، الحاجة لوحدة جوية، إلخ) لإنهاء الحالة بنجاح.</p>
                        </li>
                        <li><strong>9. نائب مركز العمليات:</strong> يساعد مركز العمليات في التوزيع والتنظيم (بالاتفاق مع Dispatch). يتولى المسؤولية عن العمليات في حال عدم قدرة Dispatch على التبليغ بعد غيابه أو عدم رده لمدة دقيقتين (يجب أن يكون متواجداً في القسم).</li>
                    </ul>
                </div>
            `,
            "s1_2": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">1.2 حقوق الشرطة</h2>
                    <p class="mb-4">يتمتع أفراد الشرطة بسلطات خاصة لأداء واجباتهم بفعالية في تطبيق القانون وحماية المجتمع. هذا القسم يوضح هذه الحقوق الأساسية.</p>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>تمنح الشرطة سلطات خاصة للتدخل في الشؤون الأمنية وتطبيق القانون، وهي محصورة برجال الشرطة فقط.</li>
                        <li>يحق للشرطي طلب وفحص الوثائق الرسمية (الهوية، رخصة القيادة، وثائق أخرى) لضمان تطبيق القانون والسلامة العامة.</li>
                        <li>يحق للشرطي إلقاء القبض على المجرمين والمطلوبين.</li>
                        <li>يسمح للشرطي استخدام صافرات الإنذار خلال الحركة للتنبيه والتحذير وتسهيل حركة المرور أثناء مهامه الأمنية.</li>
                        <li>يحق للشرطة خرق قواعد المرور إذا كان ذلك ضرورياً لأداء واجباتهم، ويُعفى من معظم مواد قواعد المرور، مما يسمح بـ:
                            <ol class="list-alpha list-inside pr-6 mt-1 space-y-1">
                                <li>عبور الإشارة الحمراء.</li>
                                <li>استخدام أكتاف الطريق.</li>
                                <li>تجاوز الحد الأقصى للسرعة.</li>
                                <li>القيادة على الجانب الخطأ من الطريق.</li>
                                <li>تجاوز المركبات من اليمين.</li>
                                <li>تجاهل لوحات (stop) عند المنعطفات.</li>
                                <li>عكس السير.</li>
                            </ol>
                        </li>
                        <li>يسمح للشرطة استخدام القوة اللازمة لأداء واجباتها وتطبيق القانون، بشرط أن يكون الاستخدام متناسباً مع الوضع ويحترم حقوق الأفراد.</li>
                        <li>يحق للشرطي تفتيش المواطن المشتبه به (مع إبلاغه: "سيتم تفتيشك للاشتباه بـ... هل تسمح بالتفتيش هنا أو في المركز؟"). إذا رفض، يؤخذ للمركز للتفتيش.</li>
                        <li>يحق للشرطي التعامل مع المواطن المزعج بموجب القوانين، وقد يؤدي ذلك للاعتقال.</li>
                        <li>يحق للشرطي سجن المجرمين بوجود أدلة، حتى بدون اعتراف.</li>
                        <li>يسمح للشرطي حجز وتفتيش المركبات المشبوهة أو المشاركة في أنشطة إجرامية لضمان تطبيق القانون والسلامة العامة.</li>
                        <li>يحق للمحققين التحقيق مع المشتبه بهم.</li>
                        <li>يسمح للشرطي استخدام سلاحه في المواقف المشبوهة والخطرة، خاصة في حالات السرقة والجرائم العنيفة.</li>
                        <li>يسمح للشرطي بالقبض على المواطن الذي يدخل مواقع غير مصرح بها (مثل مكاتب الشرطة ومواقع الجرائم) لحماية الأمن وتأمين المواقع.</li>
                        <li>يسمح للشرطي بتحرير مخالفات مالية وفقاً للقوانين.</li>
                        <li>تمنح هذه المادة الشرطي الحق في الصمت وعدم التحدث مع المجرم بعد إثبات التهم، لتحديد مقدار عقوبته.</li>
                    </ol>
                </div>
            `,
            "s1_3": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">1.3 آلية التعامل مع الحالات الجنائية</h2>
                    <p class="mb-4">يوضح هذا القسم الإجراءات التفصيلية التي يجب على أفراد الشرطة اتباعها عند التعامل مع الحالات الجنائية، بدءًا من الوصول إلى مسرح الجريمة وحتى سجن المجرمين وكتابة التقارير.</p>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>عند الوصول للموقع، تؤخذ صور تفصيلية لموقع الجريمة بالكامل.</li>
                        <li>يتم تصوير المجرم أو المشتبه به أمام موقع الجريمة عند إلقاء القبض عليه.</li>
                        <li>تُذكر حقوق ميراندا قبل إدخاله للسيارة كالتالي: (تم إلقاء القبض عليك من قبل شرطة Storm City بتهمة [نوع التهمة]. يحق لك التزام الصمت، أي شيء تقوله يستخدم ضدك في المحكمة، يحق لك توكيل محامٍ، وفي حال عدم قدرتك على توكيل محامٍ، توفر لك المحكمة واحداً إن وجد).</li>
                        <li>بعد الوصول لمركز الشرطة، يتم إدخاله للزنزانات.</li>
                        <li>يتم تفتيشه ومصادرة جميع الممنوعات (أسلحة، مسروقات، أو سلاح يزيد عن 60 رصاصة، باستثناء الأسلحة البيضاء غير المستخدمة في جريمة).</li>
                        <li>يُعطى نوع القضية ويُسأل عن سبب فعله.</li>
                        <li>يتم تصويره وأخذ بصمته في غرفة التصوير ورفعها مع التقرير.</li>
                        <li>بعد تحديد محكوميته والغرامة، يُكتب تقرير مفصل بالحادثة، وتُحفظ الأدلة المأخوذة من المجرم في غرفة الأدلة مع كتابة رقم التقرير في الدرج الخاص بالخزنة.</li>
                    </ol>
                </div>
            `,
            "s1_4": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">1.4 بروتوكولات التعامل بين شرطي و شرطي</h2>
                    <p class="mb-4">يحدد هذا القسم القواعد الأساسية للسلوك المهني والتفاعل بين أفراد الشرطة من مختلف الرتب، مع التركيز على الاحترام المتبادل، التعاون، ومكافحة الفساد لضمان بيئة عمل فعالة ومنضبطة.</p>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>يجب احترام جميع الرتب الأعلى والأقل في الشرطة، بموجب قيم الانضباط والاحترافية.</li>
                        <li>عند صدور أمر من رتبة أعلى، يجب تنفيذه باحترام وانتباه، ما لم يتعارض مع القوانين واللوائح.</li>
                        <li>إذا احتاج زميل للمساعدة، يجب تقديم كل الدعم الممكن.</li>
                        <li>الرتبة الأعلى في الميدان هي المسؤولة عن إدارة الفترة، مراقبة الحالات، وملاحظة أداء أفراد الشرطة لضمان سير العمليات بكفاءة.</li>
                        <li>إذا وجد شرطي ذو رتبة أقل أخطأ، يجب توجيهه بالطريقة الصحيحة لتجنب تكرار الخطأ. الالتزام بتقديم الدعم والتوجيه للزملاء لتطوير مهاراتهم.</li>
                        <li>عند معرفة وجود شرطي فاسد، يجب توجيه شكوى مباشرة للمسؤول الخاص به، مع إبلاغه بالتفاصيل الكاملة. هذا جزء من جهود مكافحة الفساد وتعزيز النزاهة.</li>
                        <li>يمنع منعاً باتاً الاعتداء على عناصر الشرطة مهما كانت الرتبة أو الأسباب، ويمنع استخدام الأسلحة الموجعة أو النارية أو الكهربائية تجاه أي عنصر من عناصر الشرطة.</li>
                    </ol>
                </div>
            `,
            "s1_5": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">1.5 انضباط الشرطة</h2>
                    <p class="mb-4">يحدد هذا القسم القواعد الأساسية للانضباط المهني لأفراد الشرطة، بما في ذلك الالتزام بالزي الرسمي، بروتوكولات الخروج للميدان، وإجراءات كتابة التقارير.</p>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>يجب الالتزام بالزي الرسمي أثناء ساعات العمل، كجزء من المهنية والاحترافية.</li>
                        <li>إذا كان عدد الوحدات 7 أو أكثر، يجب الخروج مع مرافق. تنطبق القاعدة على جميع الرتب باستثناء Recruits، حيث يجب عليهم الخروج مع مرافق برتبة Officer I أو أعلى. إذا لم يتوفر مرافق، يسمح له بالخروج مع Recruits كمرافق.</li>
                        <li>إجباري الالتزام بالمركبة المخصصة لك بكامل معداتها الموضحة في الموقع.</li>
                        <li>عند التوجه لحالة، يجب تبليغ مركز العمليات.</li>
                        <li>عند إلقاء القبض على شخص، يجب كتابة تقرير شامل ودقيق عن الحالة. يشمل التقرير تفاصيل الواقعة (المعلومات الشخصية للمشتبه به، الزمان والمكان، وصف الأحداث، سبب الاعتقال وظروفه).
                            <p class="mt-1 pl-6">إذا كان هناك دليل (وثائق، شهود، أدلة فيزيائية)، يجب إرفاقه في الخانة المخصصة بالتقرير. يجب أن يكون التقرير مكتملاً ومفهوماً لاستخدامه كوثيقة رسمية في المحكمة أو التحقيقات اللاحقة.</p>
                        </li>
                        <li>يمنع منعاً باتاً رسم الوشم في الوجه (كافة اكسسوارات الوجه).</li>
                        <li>الالتزام بأخذ جميع المعدات في الجدول الرسمي والتأكد من وجودها قبل كل مرة تباشر للميدان.</li>
                        <li>إذا سجلت دخولك ولم يتم توجيهك سريعاً، يمكنك طلب توزيعك الميداني من مركز العمليات.</li>
                        <li>لا يسمح للشرطي ترك مهمة موجهة له أو تسليمها لآخر.</li>
                        <li>يجب إغلاق أبواب مركز الشرطة بعد الدخول أو الخروج (باستثناء باب الاستقبال الأمامي).</li>
                        <li>يجب جمع جميع الأدلة في كل حالة لإثبات التهم على المجرمين.</li>
                        <li>يجب كتابة تقارير واضحة ومختصرة للحالات بعد الانتهاء منها وسجن المجرمين.</li>
                        <li>يحق للشرطي طلب إجازة أقصاها أسبوعين (14 يوم). ما يزيد عن ذلك قد يُرفض إلا في حالات خاصة ومؤكدة.</li>
                        <li>يجب على الشرطي إكمال 10 ساعات أسبوعياً. إذا لم يكملها، سيحصل على سترايك واحد.</li>
                        <li>الجدية في العمل وعدم أخذ الوظيفة على محمل كوميدي.</li>
                        <li>عدم تجاوز التسلسل القيادي (Chain of Command).</li>
                        <li>إذا ألقي القبض على شخص وتم توجيهك من مسؤول الحالة، يجب التعامل معه وعدم تسليم الحالة لأي شخص مهما كانت رتبتك.</li>
                    </ol>
                </div>
            `,
            "s1_6": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">1.6 قواعد سلوكيات تعامل الشرطة مع المواطنين</h2>
                    <p class="mb-4">يُركز هذا القسم على أهمية التعامل المهني والأخلاقي مع المواطنين، مع التأكيد على الاحترام، العدالة، واستخدام السلطة التقديرية بحكمة.</p>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>يجب التعامل مع جميع المواطنين بأدب واحترام تام، مهما كانت الظروف.</li>
                        <li>تؤخذ القرارات بناءً على الانتهاكات القانونية، الجرائم المحتملة، السلوك المشبوه، أو الحاجة لمعلومات هامة، دون تأثير العمر، الجنس، العرق، أو الدين.</li>
                        <li>يفضل التحدث ببطء ووضوح لتسهيل الفهم والتفاعل.</li>
                        <li>إذا لم يتبع المواطن الأمر، يجب تكراره بلطف وتهدئة لضمان الفهم والامتثال.</li>
                        <li>يجب استخدام السلطة التقديرية لمخالفات الطبيعة البسيطة بحكمة، لتطبيق القانون بعدالة والحفاظ على الاحترام.</li>
                        <li>إذا وجد الشرطي مركبة متعطلة أو متوقفة بشكل خاطئ، يجب مصادرتها.</li>
                    </ol>
                </div>
            `,
            "s1_7": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">1.7 قواعد وسلوكيات التعامل مع مجرم أو مشتبه</h2>
                    <p class="mb-4">يحدد هذا القسم الإجراءات والبروتوكولات الواجب اتباعها عند التعامل مع المجرمين والمشتبه بهم، بدءًا من الإيقاف وحتى السجن، مع التركيز على حقوق الأفراد واستخدام القوة المناسبة.</p>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>يجب على الشرطي استخدام السلطة القانونية لإيقاف المطلوبين أو المجرمين.</li>
                        <li>بعد القبض على المتهم، يتعين على الشرطة التعريف بالأدلة المتعلقة بالجريمة التي ارتكبها.</li>
                        <li>عند القبض على شخص مشتبه به، يجب على الشرطة القيام بـ:
                            <ol class="list-alpha list-inside pr-6 mt-1 space-y-1">
                                <li>التعريف عن نفسك كرجال شرطة.</li>
                                <li>إعلام المشتبه به بحقوق ميراندا.</li>
                                <li>إبلاغ المشتبه به بالجريمة المشتبه بها (يمكن ذكر التهمة الرئيسة وجمع الأخرى في المركز).</li>
                                <li>توضيح أسباب القبض على المواطن.</li>
                                <li>توضيح للمواطن أنه ليس حراً في المغادرة حتى إنهاء الإجراءات.</li>
                                <li>التأكد من صحته الجيدة.</li>
                                <li>التوجه لمركز الشرطة من الخلف.</li>
                            </ol>
                        </li>
                        <li><strong>خطوات سجن المجرم:</strong>
                            <ol class="list-decimal list-inside pr-6 mt-1 space-y-1">
                                <li>التأكد من مصادرة جميع الممنوعات.</li>
                                <li>ذكر التهم كاملة.</li>
                                <li>ذكر مدة السجن.</li>
                                <li>ذكر مجموع المخالفات.</li>
                                <li>التأكد أنه فهم ما له أو عليه (إذا كان معانداً، تجاوز هذه النقطة).</li>
                                <li>فك كلبشته.</li>
                                <li>سجن الشخص.</li>
                            </ol>
                        </li>
                        <li>إذا حاول المشتبه به الهروب أو استخدم العنف، يحق لرجال الشرطة استخدام القوة المعقولة. وفي حالة الضرورة، يمكنهم استخدام القوة المفرطة.</li>
                        <li><strong>آلية القبض على شخص في البحر:</strong>
                            <p class="mt-1 pl-6">أول ما يتوجه للبحر يتم إعطائه نطحة ثم كليشته مباشرة ويمنع استخدام التيزر.</p>
                        </li>
                        <li>إذا كان المواطن ماسكاً سلاحاً بيده دون توجيهه، حذره بوضوح أنه إذا لم يدخل سلاحه ستطلق النار عليه مباشرة. أطلق النار فوراً. أما إذا تجاوب، ألقِ القبض عليه وتوجه لمركز الشرطة للتحقيق في سبب إخراجه للسلاح. إذا كان السلاح غير مستكمل شروط التصريح، يسحب ويأخذ عقوبة إخراج سلاح دون استخدامه (باستثناء التفاوض).</li>
                    </ol>
                </div>
            `,
            "s1_8": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">1.8 قواعد وسلوكيات التعامل مع الحالات</h2>
                    <p class="mb-4">يغطي هذا القسم مجموعة واسعة من القواعد والسلوكيات للتعامل مع أنواع مختلفة من الحالات، بدءًا من الاستيقاف المروري والجنائي، وصولًا إلى حالات الخطف وحروب العصابات.</p>
                    <ol class="list-decimal list-inside space-y-2">
                        <li><strong>الاستيقاف المروري:</strong>
                            <p class="mt-1 pl-6">قوانين الاستيقاف المروري: قبل استيقاف مركبة المواطن، سجل الملاحظات واعرف التهم. بلغ مركز العمليات واذكر موقع الشارع، سبب الاستيقاف، نوع المركبة، وآخر ثلاثة أرقام من اللوحة. بعد الاستيقاف، أوقف مركبتك بشكل منحني نحو اليسار وانتظر قليلاً قبل النزول. أمر المواطن بإطفاء المحرك. إذا واجهت صعوبة، يحق لك طلب وحدة دعم في الموقع.</p>
                        </li>
                        <li><strong>النزول من المركبة في الاستيقاف المروري:</strong>
                            <p class="mt-1 pl-6">بعد النزول والتوجه لمركبة المواطن، اذكر اسمك الكامل ورقم شارتك، واشرح سبب الاستيقاف والمخالفة. اطلب الهوية والرخصة. حرر المخالفة، وإذا اعترض المواطن، أخبره بالتوجه لمركز الشرطة (يجب تحرير المخالفة قبل ذلك).</p>
                        </li>
                        <li><strong>الاستيقاف الجنائي:</strong>
                            <p class="mt-1 pl-6">عند الوصول ورؤية مركبة الجاني، بلغ مكتب العمليات وحدد موقعك، واطلب دورية دعم (لا يحق لك النزول إذا لم يكن هناك دورية دعم). إذا كانت لديك أفضلية، انزل وافتح الباب وارفع سلاحك من خلفه. حذر المشتبه به بعدم التحرك. انتظر الدعم وأخبره ألا ينزل من المركبة. إذا رأيت حركة سلاح داخل المركبة، يحق للشرطي فتح النار وإسقاط المجرم (يجب العلم أن للمواطن حق رفع شكوى مضادة إذا أطلقت النار وهو لا يحمل سلاح). حاول الهروب، يحق للشرطي إطلاق النار على كفرات المركبة (طلقة كل 30 ثانية ثم الاستمرار) والاستمرار في المطاردة.</p>
                        </li>
                        <li>عند الوصول لموقع جنائي، يجب القيام بـ:
                            <ol class="list-alpha list-inside pr-6 mt-1 space-y-1">
                                <li>تبليغ مركز العمليات عن الحادث.</li>
                                <li>إيقاف المشتبهين داخل الموقع.</li>
                                <li>إغلاق الطريق إذا كنت في الطرق السريعة أو الفرعية.</li>
                                <li>يمنع التوجه لحالة قبل وصول وحدة أخرى على الأقل.</li>
                            </ol>
                            <p class="mt-1 pl-6"><strong>تنبيه:</strong> إذا دخل المواطن الموقع، يحق لك اعتقاله بتهمة عرقلة عمل الشرطة.</p>
                        </li>
                        <li>في حالات الخطف، على الشرطة محاولة التحدث مع المجرمين وتبليغهم باختيار موقع للتفاوض سريعاً. في حال تعيين مفاوض، يتبع الأنظمة الموضحة وتستكمل الحالة. عند إتمام التفاوض، يعين شرطي لاستخراج الرهينة وأخذ البصمات.</li>
                        <li>لا يسمح بتحرير الرهائن نهائياً (بإفشال التفاوض).</li>
                        <li>في حالات حرب العصابات، في البداية على الشرطة الإحاطة بالموقع ووحدة جوية واحدة (أو وحدتين إذا كان عدد الوحدات الأرضية كبيراً). الانتظار لوقت كافٍ حتى توقف إطلاق النار، ثم يسمح للشرطة بالتدخل بحذر شديد (لأنهم مسلحون). يجب أن يكون الدخول منظماً مع أخذ الحيطة والحذر، وإلقاء القبض على جميع المتواجدين ومحاسبتهم بتهمة حرب العصابات.</li>
                    </ol>
                </div>
            `,
            "s1_9": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">1.9 قواعد وسلوكيات التعامل مع المطاردة</h2>
                    <p class="mb-4">يحدد هذا القسم القواعد والإجراءات الخاصة بالتعامل مع المطاردات، بما في ذلك استخدام القوة، حدود المركبات المسموح بها، وبروتوكولات الصدم الاحترافي لضمان السلامة والفعالية.</p>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>يحق للشرطة صدم المركبات في الحالات التالية:
                            <ol class="list-alpha list-inside pr-6 mt-1 space-y-1">
                                <li>عندما يحاول الهارب تعطيل مركبة الشرطي.</li>
                                <li>عندما يتم تهديد حياة الشرطي أو المواطنين.</li>
                                <li>عندما يكون الهارب مسؤولاً عن إصابة شخص أو وفاته.</li>
                            </ol>
                        </li>
                        <li>يحق لك إطلاق النار على الكفرات (طلقة واحدة كل 30 ثانية) إذا حاول دهسك بالمركبة.</li>
                        <li>الحد الأقصى للمطاردة هو 3 مركبات أرضية، ويمكن زيادته بأمر من المشرف على الحالة.</li>
                        <li><strong>الصدم الاحترافي:</strong>
                            <ol class="list-alpha list-inside pr-6 mt-1 space-y-1">
                                <li>يجب الصدم باحترافية وتجنب التهور (كما هو موضح في القوانين).</li>
                                <li>يجب أخذ مسافة آمنة بين الشرطة والمجرم قبل بدء الصدم، ويتقدم أحد مركبات الشرطة لصدم المجرم.</li>
                                <li>يبدأ الصدم الاحترافي بعد 5 دقائق من المطاردة.</li>
                                <li>إذا عرض الشخص حياة المواطنين للخطر، يبدأ الصدم الاحترافي مباشرة.</li>
                                <li>يجب أن يكون الصدم الاحترافي في كل فرصة محققة.</li>
                                <li>يمنع الصدم الاحترافي في حال عدم وجود مركبة دعم واحدة على الأقل.</li>
                                <li>السرعة المسموحة بالصدم الاحترافي تحت 200 كم/س.</li>
                                <li>يمنع الصدم داخل مناطق تعبئة الوقود والمناطق الجبلية.</li>
                                <li>يمنع الصدم إذا كانت مركبتك أو مركبة المجرم تدخن.</li>
                                <li>يجب أن تكون بين صدمة وأخرى 30 ثانية كاملة.</li>
                            </ol>
                        </li>
                    </ol>
                </div>
            `,
            "s2_0": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">2.0 بروتوكولات التفاوض</h2>
                    <p class="mb-4">يُفصل هذا القسم بروتوكولات التفاوض في حالات الأزمات، مثل الخطف أو احتجاز الرهائن، مع التركيز على التواصل الفعال، تقييم الوضع، والوصول إلى حلول آمنة.</p>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>عند الوصول لموقع الحادث، بلغ Dispatch بتفاصيل الحالة (المركبات، عدد الأشخاص).</li>
                        <li>عند تعيينك كمفاوض من مسؤول الحالة، بلغ المجرمين بأنك المفاوض الرسمي من الشرطة.</li>
                        <li>عند التواصل مع الشخص، عرف بنفسك بالاسم والبادج لإقامة الثقة.</li>
                        <li>ابدأ التفاوض مع الشخص وتحقق من سلامة الرهينة كأولوية قصوى.</li>
                        <li>يجب توفر وحدة إسعاف في الموقع والدخول مع المفاوض للتأكد من الرهينة. عند الدخول، ركز على مواصفات الأشخاص وعددهم وأسلحتهم لتقديم تقرير دقيق لمسؤول الحالة.</li>
                        <li>ابدأ الاستفسار عن حالته الصحية والنفسية. يبدأ المسعف بالتأكد من حالته ثم الاستفسار عن معلومات الرهينة.</li>
                        <li>عند الخروج من الموقع، بلغ مسؤول الحالة بجميع المعلومات التي تم الحصول عليها.</li>
                        <li>ابدأ المفاوضات مع الشخص واتفق على مدة زمنية محددة للتفاوض.</li>
                        <li>يجب أن يكون مفاوض الشرطة قادراً على التفاوض بذكاء وحنكة، مع توجيه المحادثات بمهنية للوصول لحلول مبنية على المصالح المشتركة، مع الأخذ بعين الاعتبار أن هناك حياة شخص بين يديك. تعامل مع الموقف بجدية تامة وأسلوب سلس.</li>
                        <li>بعد الاتفاق مع المجرم، بلغ مسؤول الحالة بمتطلبات الأشخاص.</li>
                        <li>يجب بدء التوزيع الميداني بناءً على المعلومات المتوفرة.</li>
                        <li>أقل مدة للخروج الآمن هي دقيقتين فقط.</li>
                        <li>يقلل وقت الهروب فقط في حال حدوث الأسباب التالية:
                            <ol class="list-alpha list-inside pr-6 mt-1 space-y-1">
                                <li>تعنيف الرهينة = من (دقيقة) إلى (دقيقتين).</li>
                                <li>عدم تنفيذ متطلبات الرهينة (إعطاء أكل - الحصول على الرعاية الطبية) = (دقيقتين فقط).</li>
                                <li>عدم الجدية من طرف المجرمين (يجب رفع شكوى لإدارة السيرفر). استكمل التفاوض داخل RP = (دقيقتين فقط).</li>
                                <li>عدم احترام مفاوض الشرطة = (3 دقائق).</li>
                                <li>الخروج من موقع السرقة باستثناء مفاوض المجرمين = (دقيقة).</li>
                            </ol>
                        </li>
                    </ol>
                </div>
            `,
            "s2_1": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">2.1 أحكام أخرى للسرقات</h2>
                    <p class="mb-4">يتناول هذا القسم تفاصيل إضافية تتعلق بالتعامل مع حالات السرقات المختلفة، بما في ذلك العوامل التي قد تؤثر على سير عملية الهروب الآمن، والإجراءات المتبعة في حال عدم وجود رهائن، وتحديد أعداد أفراد الشرطة المناسبة لكل نوع من أنواع السرقات.</p>
                    
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold text-sky-600 mb-2">1. مفشلات الهروب الآمن:</h3>
                        <ul class="list-disc list-inside space-y-1">
                            <li>التوجه للبحر.</li>
                            <li>التدخل الخارجي.</li>
                            <li>دخول الورشة أو تعديل المركبة.</li>
                            <li>استخراج السلاح الناري بشكل صريح وواضح.</li>
                            <li>تعريض حياة المواطنين بشكل متعمد وواضح ومتكرر.</li>
                            <li>تغيير المركبة.</li>
                            <li>التوجه أو القرب إلى البحر.</li>
                            <li>في حال النزول من المركبة ومحاولة الهروب في مركبة أخرى يحق للعسكري استخدام التيزر بشكل مباشر.</li>
                            <li>بعد مرور الوقت المحدد من قبل مفاوض الشرطة (من وقت بدء المطاردة).</li>
                        </ul>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-xl font-semibold text-sky-600 mb-2">2. في حال عدم وجود رهينة:</h3>
                        <p>في حالة سرقة البقالة، تُصف المركبات أمام الموقع باحترافية، ويُوقف بجانب باب المركبة واستخدامه كحاجز. يُرفع السلاح الصاعق ويُنتظر المجرم للخروج، مع رفع الصوت لإبلاغه بتسليم نفسه. إذا دخل مركبته وهرب، يُستكمل التعامل معه وفقاً للقوانين الموضحة.</p>
                    </div>

                    <div>
                        <h3 class="text-xl font-semibold text-sky-600 mb-2">3. أعداد الشرطة في السرقات:</h3>
                        <p class="mb-3">يوضح الجدول التالي الحد الأدنى والأقصى لعدد أفراد الشرطة المطلوبين للتعامل مع أنواع السرقات المختلفة.</p>
                        <div class="chart-container h-auto md:h-[600px]">
                            <canvas id="robberyStaffingChart"></canvas>
                        </div>
                    </div>
                </div>
            `,
            "s2_2": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">2.2 حقوق المواطنين</h2>
                    <p class="mb-4">يُفصل هذا القسم حقوق المواطنين أثناء تفاعلهم مع الشرطة، بما في ذلك حقوقهم القانونية، حق الحصول على محامٍ، وحقوقهم أثناء التحقيق والاستيقاف لضمان العدالة والشفافية.</p>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>يجب على الشرطي إبلاغ الشخص المعتقل بحقوق ميراندا (تم القبض عليك من شرطة Storm City بتهمة [نوع التهمة]. يحق لك التزام الصمت، أي شيء تقوله يستخدم ضدك في المحكمة، كما يحق لك توكيل محامٍ، وفي حال عدم قدرتك على توكيل محامٍ، توفر لك الولاية محامياً إن وجد).</li>
                        <li>إذا رغب المواطن في مساعدة قانونية، يمكنه الاستعانة بمحامٍ معتمد ليمثله ويساعده في تحليل الأدلة وتقديم الدفاع. هذا يضمن تمثيله الأمثل. كما يحق للمواطن التعرف على الأدلة المقدمة ضده دون محامٍ، خاصة إذا لم يكن متهماً بوضوح، مما يساعده على فهم القضية والمشاركة بفعالية في الدفاع عن حقوقه.</li>
                        <li>لا يحق للعسكري التحقيق مع المواطن بمدة تزيد عن 30 دقيقة بدون موافقة المواطن (يجب خصم المدة من مدة السجن).</li>
                        <li>ينبغي لكل شرطي التعامل مع المواطن باحترام وتقدير، والالتزام بأخلاقيات المهنة وحقوق الإنسان. يجب أن يكونوا محترفين ولطفاء ومتجاوبين مع الجميع دون تمييز أو تحيز.</li>
                        <li>عند الوصول للزنزانات، على الشرطي الالتزام بأخلاقيات عمله وقوانين الحقوق المدنية، وإبلاغ المعتقل بوضوح وشفافية بتهمة الاعتقال وسببها.</li>
                        <li>يحق للمواطن طرد الشرطي من ممتلكاته الخاصة، إلا في حالات معينة مثل موقع جنائي، مذكرة تفتيش، أو بلاغ جنائي في الموقع.</li>
                        <li>خلال الاعتقال أو التوقيف المروري، يتعين على الشرطي إبلاغ المواطن بوضوح ودقة بسبب الاعتقال/التوقيف وحقوقه، وتحديد هويته بوضوح.</li>
                        <li>يتعين على الشرطي احترام حقوق المواطن خلال الاستيقاف المروري. لا يحق له التفتيش إلا بتحويل الاستيقاف إلى جنائي بناءً على أسباب أمنية موضوعية أو أدلة كافية.</li>
                        <li>لا يحق للشرطي بأي شكل من الأشكال الترصد للمواطنين والبحث عن زلاتهم إلا بوجود مذكرة مراقبة.</li>
                        <li>يحق للمواطن الخروج بكفالة إذا توفرت وفقاً للقوانين. على الشرطي الالتزام بلائحة المخالفات المعتمدة، والتعامل بعدل وإنصاف دون تحيز.</li>
                    </ol>
                </div>
            `,
            "s2_3": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">2.3 قواعد وسلوكيات التعامل مع أفراد الطاقم الطبي</h2>
                    <p class="mb-4">يحدد هذا القسم الإرشادات للتعامل الفعال والمهني بين أفراد الشرطة والطاقم الطبي، مع التأكيد على الاحترام المتبادل، الامتثال للأوامر، وتجنب التدخل في الشؤون الطبية.</p>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>يكون التعامل بين الشرطة والطاقم الطبي احترافياً بحدود المهنة. يجب على الشرطي الامتثال لأوامر الطاقم الطبي في الحالات التي تستدعي تدخلهم.</li>
                        <li>عند احتياج الطاقم الطبي للشرطة، يرسل Dispatch البلاغ لأقرب وحدة للموقع، وتقوم الوحدة بتأمين الموقع والمحافظة على النظام.</li>
                        <li>يجب على الشرطي الامتثال لجميع أوامر وقواعد الطاقم الطبي داخل المستشفى واحترامها.</li>
                        <li>إذا وجد طاقم إسعاف على رأس العمل، يُطلب منهم عبر 997 لمساعدة الأشخاص المسقطين. لا يحق للشرطي نقل الحالات بنفسه للمستشفى.</li>
                        <li>يمنع التدخل في أعمال أو شؤون تخص الصحة أو الإسعاف.</li>
                    </ol>
                </div>
            `,
            "s2_4": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">2.4 قواعد وسلوكيات عامة</h2>
                    <p class="mb-4">يغطي هذا القسم مجموعة من القواعد والسلوكيات العامة التي يجب على أفراد الشرطة الالتزام بها لضمان الكفاءة، الاحترافية، والامتثال للبروتوكولات في جميع جوانب عملهم اليومي.</p>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>عند بداية دوامك، تأكد من معداتك بالكامل وافحص جاهزية مركبتك.</li>
                        <li>قبل النزول للميدان، تأكد من جميع الـ Warrants لتذكرها أثناء تعاملك مع أي مواطن.</li>
                        <li>اترك الحالات الأقل أهمية إذا وردتك حالة أكثر أهمية حسب توجيه Dispatch بعد طلب الإذن.</li>
                        <li>عدم التعرض لسرقة أو استعارة مركبات المواطنين لأي سبب.</li>
                        <li>يمنع التجارة أو بيع أو إعطاء معدات الشرطة للمواطنين أو المسعفين.</li>
                        <li>بلغ Dispatch عند مباشرة حالة بعد طلب الإذن أو عند التعامل مع أي حالة.</li>
                        <li>عند مباشرتك لحالة، اجمع الأدلة ووثقها وامسح المتبقي منها.</li>
                        <li>الـ Reports: تقارير حوادث حدثت ولكن الفاعل مجهول، وتُجمع الأدلة للتحقيق فيها.</li>
                        <li>الـ Incidents: تقارير حوادث حدثت وتم إلقاء القبض على فاعلها.</li>
                        <li>الـ BOLOS: تقارير تخص المركبات (المسروقة/المطلوبة).</li>
                    </ol>
                </div>
            `,
            "s2_5": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">2.5 قواعد وسلوكيات المجرمين</h2>
                    <p class="mb-4">يحدد هذا القسم القواعد المتعلقة بالتعامل مع المجرمين فيما يخص جمع التهم، مدة السجن، والإجراءات القضائية في حالات السجن الطويل.</p>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>في حال السرقة، تُجمع كافة التهم في التقرير الخاص بك، ولكن السجن 60 شهراً فقط.</li>
                        <li>إذا وصلت مدة سجنك إلى 1000 شهر، يُطلب منك الحضور إلى المحكمة التي تقام داخل نظام الشرطة أو العدل (إن وجد).</li>
                    </ol>
                </div>
            `,
            "s2_6": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">2.6 الأسلحة والذخائر</h2>
                    <p class="mb-4">يُفصل هذا القسم القواعد الصارمة المتعلقة باستخدام الأسلحة النارية، الصاعقة، والنطح من قبل أفراد الشرطة، مع تحديد الحالات التي يسمح فيها باستخدام كل نوع من القوة لضمان السلامة والامتثال القانوني.</p>
                    <h3 class="text-xl font-semibold text-sky-600 mb-2">يجب على الشرطة إشهار أسلحتهم النارية في الحالات التالية:</h3>
                    <ol class="list-decimal list-inside space-y-1">
                        <li>عند الشعور بالتهديد والخوف على حياتك.</li>
                        <li>قبل إطلاق النار على الشخص، يجب تحذيره لفظياً أو بطلقات تحذيرية (يجب ألا تسبب الطلقة خطراً أو تهديداً لحياته).</li>
                    </ol>
                    <h3 class="text-xl font-semibold text-sky-600 mt-4 mb-2">الشرطة لا يسمح لها بإطلاق النار إلا في الحالات التالية:</h3>
                    <ol class="list-decimal list-inside space-y-1">
                        <li>عندما يوجه المجرم سلاحه نحو أي مواطن أو شرطي.</li>
                        <li>عندما يتعرض لك بأي طريقة باستثناء القوة المعقولة.</li>
                        <li>عندما يحمل المجرم سلاحاً في مكان حدث فيه إطلاق نار (يجب تحذيره أولاً).</li>
                        <li>الطلقات التحذيرية (في حالات مثل المرور المتكرر والإزعاج والمعيق لعمل الشرطة، وغيرها) وتكون طلقتين في مكان لا يؤثر على المواطن بهدف التنبيه.</li>
                        <li>دهس الشرطي بشكل متعمد: طلق النار على الكفرات (طلقة واحدة كل 30 ثانية). في حال التكرار، طلق على الشخص.</li>
                        <li>تعمد الشخص صدم مركبات الشرطة أو المواطنين: طلق النار على الكفرات (طلقة واحدة كل 30 ثانية). في حال التكرار، طلق على الشخص.</li>
                        <li>تكرار الشخص للقفزات الانتحارية: طلق النار على الكفرات فقط (طلقة واحدة).</li>
                        <li>إشهار أحد المواطنين سلاحه الناري تجاهك وأنت تحمل سلاحك الناري: يحق لك إسقاطه فوراً.</li>
                    </ol>
                    <h3 class="text-xl font-semibold text-sky-600 mt-4 mb-2">يجب على الشرطة استخدام السلاح الصاعق في الحالات التالية:</h3>
                    <ol class="list-decimal list-inside space-y-1">
                        <li>عندما يهرب المجرم على الأقدام (بعد 30 ثانية).</li>
                        <li>عندما يهرب المجرم منك أثناء القبض عليه (بعد 30 ثواني).</li>
                        <li>عندما يرفض المجرم النزول من المركبة (بعد 5 ثواني) وفي حال المحرك شغال، استخدم الصاعق بشكل مباشر.</li>
                        <li>عندما تكون في مستشفى أو في موقع حكومي (بعد التحذير مرتين).</li>
                        <li>في حال هرب المجرم بعد المعالجة (إذا كان مسقط)، يتم تيزرته بشكل مباشر.</li>
                        <li>بين كل تيزر وتيزر 30 ثانية.</li>
                        <li>التييزر فقط من أقرب أوفسر للمجرم.</li>
                        <li>لا يسمح استخدام السلاح الصاعق إذا كان مبللاً أو كان يوجد مطر أو داخل البحر.</li>
                    </ol>
                    <h3 class="text-xl font-semibold text-sky-600 mt-4 mb-2">يجب على الشرطة استخدام النطح في الحالات التالية:</h3>
                    <ol class="list-decimal list-inside space-y-1">
                        <li>يحق لك نطح الشخص (ضربة باليد بعد مرور 10 ثواني من المطاردة على الأقدام).</li>
                        <li>بين كل نطح ونطح 5 ثواني، ويجب إخبار المتهم أو المواطن.</li>
                        <li>يجب تنبيه إذا كانت النطحة تؤثر بحياة المواطن.</li>
                        <li>يحق لك نطح الشخص إذا هرب ولم يكن معه سلاح بيده.</li>
                        <li>يمنع النطح إذا استخرج سلاح أبيض أو ناري.</li>
                    </ol>
                </div>
            `,
            "s2_7": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">2.7 ترخيص استخدام الأسلحة للمواطنين</h2>
                    <p class="mb-4">يحدد هذا القسم شروط ومتطلبات ترخيص الأسلحة للمواطنين، مع التركيز على حدود الذخيرة، حالات الاستخدام المسموح بها، والعوامل التي قد تؤدي إلى إلغاء الترخيص.</p>
                    <h3 class="text-xl font-semibold text-sky-600 mb-2">شروط الأسلحة المرخصة للمواطنين:</h3>
                    <ol class="list-decimal list-inside space-y-1">
                        <li>60 رصاصة كحد أقصى يحملها الشخص.</li>
                        <li>يستخدم فقط في حالات الدفاع عن النفس.</li>
                        <li>يعتبر الترخيص لاغياً إذا استخدم السلاح أمام عناصر الشرطة (باستثناء السرقات التي تستدعي استخدام السلاح).</li>
                    </ol>
                </div>
            `,
            "s2_8": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">2.8 بروتوكولات وقوانين التقاعد</h2>
                    <p class="mb-4">يُفصل هذا القسم الإجراءات والقوانين المتعلقة بتقاعد أفراد الشرطة، بما في ذلك شروط التقديم، العودة من التقاعد، وسحب المسؤوليات، لضمان عملية تقاعد منظمة وعادلة.</p>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>في حال التقاعد، يجب أن تكون المدة شهر على الأقل بين كسر التقاعد والتقاعد مرة أخرى.</li>
                        <li>في حال العودة بعد التقاعد، تُكسر رتبة المتقاعد إلى رتبتين وتحددها رئاسة الشرطة.</li>
                        <li>في حال التقاعد، تُسحب جميع المسؤوليات والوثائق وكل ما يتعلق بالشخص، ويتعامل عليها قائد القسم.</li>
                        <li>في حال العودة من التقاعد، يُعطى الشخص مدة معينة لإثبات نفسه (تقدرها رئاسة الشرطة).</li>
                        <li>يجب على الشخص تقديم سبب واضح للتقاعد.</li>
                        <li>يجب ألا يكون على الشخص محاسبة جارية المفعول عند تقديم التقاعد.</li>
                        <li>طلب التقاعد لا يشترط قبوله، فمن الممكن رفضه.</li>
                        <li>التقاعد من رتبة Corporal فما فوق فقط.</li>
                    </ol>
                </div>
            `,
            "s2_9": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">2.9 التحذيرات والمحاسبات</h2>
                    <p class="mb-4">يحدد هذا القسم آليات التحذيرات والسترايكات (النقاط السلبية) في سجل أفراد الشرطة، مع توضيح مدة سريان التحذيرات، أسباب الحصول على السترايك، وتأثيرها على الرتبة والترقية.</p>
                    <h3 class="text-xl font-semibold text-sky-600 mb-2">آلية التحذيرات في الشرطة:</h3>
                    <ol class="list-decimal list-inside space-y-1">
                        <li>التحذير الأول يستمر لأسبوع ثم يزال.</li>
                        <li>التحذير الثاني يستمر لثلاثة أسابيع ثم يزال.</li>
                        <li>التحذير الثالث يؤدي لكسر رتبة الأوفيسر / الشرطي.</li>
                        <li>الحصول على تحذير يحرم من الترقية حتى انتهاء مدة التحذير.</li>
                        <li>في حال أخذ إجازة، يستأنف وقت التحذير حتى انتهاء الإجازة ثم يستكمل.</li>
                    </ol>
                    <h3 class="text-xl font-semibold text-sky-600 mt-4 mb-2">آلية السترايك في الشرطة:</h3>
                    <ol class="list-decimal list-inside space-y-1">
                        <li>السترايك: نقطة توضع في سجل الشرطي ولا يمكن إزالتها نهائياً.</li>
                        <li>يُحصل على السترايك فقط من خلال: (1- عدم إكمال الساعات. 2- عدم حضور اجتماع).</li>
                        <li>أقصى حد للسترايك هو 7. كل 3 سترايكات تؤدي لكسر رتبة. عند الحصول على كامل السترايكات، يُفصل الأوفيسر مباشرة.</li>
                        <li>SOON.</li>
                    </ol>
                </div>
            `,
            "s3_0": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">3.0 أولوية التعامل مع الحالات</h2>
                    <p class="mb-4">يحدد هذا القسم نظام أولويات التعامل مع الحالات المختلفة، مما يضمن استجابة سريعة وفعالة للحوادث الأكثر خطورة، مع تصنيف الحالات إلى مستويات أولوية عالية، متوسطة، وعادية.</p>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>يتم التعامل مع الحالات حسب الأولوية 1 (الأعلى). تُترك جميع الحالات الأخرى ويُتوجه للحالة الأهم فالأهم، بعد توجيه Dispatch فقط.</li>
                    </ol>
                    <h3 class="text-xl font-semibold text-sky-600 mt-4 mb-2">Priority 1 (Highest Priority Transport)</h3>
                    <h4 class="text-lg font-semibold text-sky-600 mb-2">أولوية عالية للتعامل مع الحالات التالية:</h4>
                    <ul class="list-disc list-inside space-y-1 pr-4">
                        <li>قتل شرطي أو اعتداء مسلح على أحد الأفراد.</li>
                        <li>خطف أو احتجاز أحد أفراد الشرطة.</li>
                        <li>الاستنفار الأمني.</li>
                    </ul>
                    <h3 class="text-xl font-semibold text-sky-600 mt-4 mb-2">Priority 2 (Medium Priority Transport)</h3>
                    <h4 class="text-lg font-semibold text-sky-600 mb-2">أولوية متوسطة للتعامل مع الحالات التالية:</h4>
                    <ul class="list-disc list-inside space-y-1 pr-4">
                        <li>سرقة ميز بنك.</li>
                        <li>سرقة المجوهرات الكبيرة.</li>
                        <li>سرقة المتحف.</li>
                        <li>سرقة المجوهرات.</li>
                        <li>سرقة بوبكات.</li>
                        <li>سرقة مصرف.</li>
                        <li>سرقة سيارة البنك.</li>
                        <li>سرقة مكيفات - سرقة الغسالات.</li>
                        <li>سرقة الكاش.</li>
                    </ul>
                    <h3 class="text-xl font-semibold text-sky-600 mt-4 mb-2">Priority 3 (Low Priority Transport)</h3>
                    <h4 class="text-lg font-semibold text-sky-600 mb-2">أولوية عادية للتعامل مع الحالات التالية:</h4>
                    <ul class="list-disc list-inside space-y-1 pr-4">
                        <li>سرقة منزل.</li>
                        <li>سرقة بقالة.</li>
                        <li>طلق نار.</li>
                        <li>سرقة سيارة.</li>
                        <li>بلاغات 911.</li>
                    </ul>
                </div>
            `,
            "s3_1": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">3.1 سلم الصلاحيات - (A.O.P)</h2>
                    <p class="mb-4">يوضح هذا القسم التسلسل الهرمي للصلاحيات والمسؤوليات داخل قسم الشرطة، وفقًا لنظام شرطة لوس أنجلوس (LAPD). فهم هذا السلم ضروري لضمان سير العمليات بفعالية واحترام التسلسل القيادي.</p>
                    <div class="space-y-6">
                        <div class="p-4 border border-slate-300 rounded-md bg-slate-50">
                            <h4 class="text-lg font-semibold text-sky-600">1. Chief of Police (رئيس الشرطة):</h4>
                            <ul class="list-disc list-inside mt-2 space-y-1 pr-4">
                                <li>أعلى سلطة في القسم، مسؤول عن القيادة العامة والإدارة الاستراتيجية.</li>
                                <li>يضع السياسات والأهداف الرئيسية للقسم.</li>
                                <li>يمثل القسم أمام الجمهور والجهات الحكومية.</li>
                            </ul>
                        </div>
                        <div class="p-4 border border-slate-300 rounded-md bg-slate-50">
                            <h4 class="text-lg font-semibold text-sky-600">2. Assistant Chief (مساعد الرئيس):</h4>
                             <ul class="list-disc list-inside mt-2 space-y-1 pr-4">
                                <li>ثاني أعلى رتبة، يشرف على المكاتب الرئيسية (مثل مكتب العمليات، مكتب التحقيقات).</li>
                                <li>يقدم الدعم لرئيس الشرطة في الإدارة اليومية.</li>
                            </ul>
                        </div>
                        <div class="p-4 border border-slate-300 rounded-md bg-slate-50">
                            <h4 class="text-lg font-semibold text-sky-600">3. Deputy Chief (نائب الرئيس):</h4>
                            <ul class="list-disc list-inside mt-2 space-y-1 pr-4">
                                <li>يقود مكتبًا أو قسمًا متخصصًا كبيرًا (مثل مكتب العمليات الميدانية، مكتب التحقيقات الجنائية).</li>
                                <li>مسؤول عن تنفيذ السياسات والإشراف على الأداء في نطاق مسؤوليته.</li>
                            </ul>
                        </div>
                        <div class="p-4 border border-slate-300 rounded-md bg-slate-50">
                            <h4 class="text-lg font-semibold text-sky-600">4. Commander (قائد):</h4>
                            <ul class="list-disc list-inside mt-2 space-y-1 pr-4">
                                <li>يقود مجموعة من الأقسام أو وحدات متخصصة.</li>
                                <li>يشرف على العمليات اليومية ويضمن التنسيق بين الوحدات.</li>
                            </ul>
                        </div>
                        <div class="p-4 border border-slate-300 rounded-md bg-slate-50">
                            <h4 class="text-lg font-semibold text-sky-600">5. Captain (نقيب):</h4>
                            <ul class="list-disc list-inside mt-2 space-y-1 pr-4">
                                <li>يقود قسمًا معينًا (مثل قسم الدوريات، قسم المباحث).</li>
                                <li>مسؤول عن إدارة الموارد البشرية والعمليات داخل قسمه.</li>
                            </ul>
                        </div>
                        <div class="p-4 border border-slate-300 rounded-md bg-slate-50">
                            <h4 class="text-lg font-semibold text-sky-600">6. Lieutenant (ملازم):</h4>
                            <ul class="list-disc list-inside mt-2 space-y-1 pr-4">
                                <li>يشرف على وردية عمل أو وحدة متخصصة داخل قسم.</li>
                                <li>مسؤول عن التوجيه والإشراف المباشر على الرقباء والضباط.</li>
                            </ul>
                        </div>
                        <div class="p-4 border border-slate-300 rounded-md bg-slate-50">
                            <h4 class="text-lg font-semibold text-sky-600">7. Sergeant (رقيب):</h4>
                            <ul class="list-disc list-inside mt-2 space-y-1 pr-4">
                                <li>المشرف المباشر الأول على الضباط في الميدان.</li>
                                <li>مسؤول عن تطبيق الإجراءات وضمان الامتثال للقواعد.</li>
                                <li>يقدم الدعم والتوجيه للضباط الأقل رتبة.</li>
                            </ul>
                        </div>
                        <div class="p-4 border border-slate-300 rounded-md bg-slate-50">
                            <h4 class="text-lg font-semibold text-sky-600">8. Police Officer III (ضابط شرطة ثالث):</h4>
                            <ul class="list-disc list-inside mt-2 space-y-1 pr-4">
                                <li>ضابط ذو خبرة، وغالبًا ما يكون ضابط تدريب ميداني.</li>
                                <li>يقوم بمهام الدوريات والاستجابة للحوادث.</li>
                            </ul>
                        </div>
                        <div class="p-4 border border-slate-300 rounded-md bg-slate-50">
                            <h4 class="text-lg font-semibold text-sky-600">9. Police Officer II (ضابط شرطة ثانٍ):</h4>
                            <ul class="list-disc list-inside mt-2 space-y-1 pr-4">
                                <li>ضابط دورية ذو خبرة متوسطة.</li>
                                <li>يقوم بمهام الدوريات والاستجابة للحوادث.</li>
                            </ul>
                        </div>
                        <div class="p-4 border border-slate-300 rounded-md bg-slate-50">
                            <h4 class="text-lg font-semibold text-sky-600">10. Police Officer I (ضابط شرطة أول):</h4>
                            <ul class="list-disc list-inside mt-2 space-y-1 pr-4">
                                <li>ضابط مبتدئ، يعمل تحت إشراف مباشر.</li>
                                <li>يتعلم الإجراءات والبروتوكولات الأساسية.</li>
                            </ul>
                        </div>
                        <div class="p-4 border border-slate-300 rounded-md bg-slate-50">
                            <h4 class="text-lg font-semibold text-sky-600">11. Cadet (كاديت / متدرب):</h4>
                            <ul class="list-disc list-inside mt-2 space-y-1 pr-4">
                                <li>رتبة متدرب، يكون موجوداً ويداوم مع العسكر ولكن تحت الاختبار والتدريب.</li>
                                <li>توجد فترة محددة من قبل الأكاديمية لفترة تدريبه.</li>
                                <li>هناك متطلبات يجب أن يكملها لاجتياز الاختبار (المتطلبات عند مسؤولي الأكاديمية).</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `,
            "llm_consultation": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">استشارة سريعة ✨</h2>
                    <p class="mb-4">استخدم هذا القسم للحصول على مساعدة فورية من نموذج الذكاء الاصطناعي الخاص بنا. يمكنك طرح أسئلة حول إجراءات معينة، أو طلب توضيح لموقف، أو الحصول على توجيهات عامة بناءً على محتوى الكتيب.</p>
                    <div class="mb-4">
                        <label for="llm-query-input" class="block text-slate-700 text-sm font-bold mb-2">اطرح سؤالك أو صف الموقف:</label>
                        <textarea id="llm-query-input" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-sky-500 focus:border-sky-500 h-32" placeholder="مثال: ما هي خطوات التعامل مع حالة خطف؟"></textarea>
                    </div>
                    <div class="mb-4 flex items-center">
                        <button id="llm-submit-btn" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-colors">
                            احصل على استشارة ✨
                        </button>
                        <span id="llm-loading-indicator" class="hidden text-slate-600 text-sm mr-2">
                            <span class="loading-spinner"></span> جاري المعالجة...
                        </span>
                    </div>
                    <div id="llm-response-output" class="bg-slate-50 p-4 rounded-md border border-slate-200 min-h-[100px] text-slate-800 whitespace-pre-wrap">
                        الرد سيظهر هنا.
                    </div>
                </div>
            `,
            "scenario_analysis": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">تحليل السيناريوهات ✨</h2>
                    <p class="mb-4">أدخل وصفاً لسيناريو معين أو موقف قد تواجهه في عملك كشرطي. سيقوم النموذج بتقديم مسار عمل مقترح خطوة بخطوة بناءً على إجراءات الكتيب، مع الأخذ في الاعتبار سياق اللعبة (FiveM/GTA) إذا لم تكن الإجابة مباشرة في الكتيب.</p>
                    <div class="mb-4">
                        <label for="scenario-input" class="block text-slate-700 text-sm font-bold mb-2">صف السيناريو:</label>
                        <textarea id="scenario-input" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-sky-500 focus:border-sky-500 h-40" placeholder="مثال: واجهت مشتبهاً به يقاوم الاعتقال بعد سرقة بقالة. ما هي الخطوات؟"></textarea>
                    </div>
                    <div class="mb-4 flex items-center">
                        <button id="scenario-submit-btn" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-colors">
                            تحليل السيناريو ✨
                        </button>
                        <span id="scenario-loading-indicator" class="hidden text-slate-600 text-sm mr-2">
                            <span class="loading-spinner"></span> جاري التحليل...
                        </span>
                    </div>
                    <div id="scenario-response-output" class="bg-slate-50 p-4 rounded-md border border-slate-200 min-h-[100px] text-slate-800 whitespace-pre-wrap">
                        الرد على السيناريو سيظهر هنا.
                    </div>
                </div>
            `,
            "training_questions": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">اقتراح أسئلة تدريبية ✨</h2>
                    <p class="mb-4">اختر قسماً من الكتيب لإنشاء أسئلة تدريبية تساعدك على اختبار فهمك للإجراءات والبروتوكولات.</p>
                    <div class="mb-4">
                        <label for="question-section-select" class="block text-slate-700 text-sm font-bold mb-2">اختر القسم:</label>
                        <select id="question-section-select" class="shadow border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-sky-500 focus:border-sky-500">
                            </select>
                    </div>
                    <div class="mb-4 flex items-center">
                        <button id="generate-questions-btn" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-colors">
                            توليد الأسئلة ✨
                        </button>
                        <span id="questions-loading-indicator" class="hidden text-slate-600 text-sm mr-2">
                            <span class="loading-spinner"></span> جاري التوليد...
                        </span>
                    </div>
                    <div id="questions-output" class="bg-slate-50 p-4 rounded-md border border-slate-200 min-h-[100px] text-slate-800 whitespace-pre-wrap">
                        الأسئلة ستظهر هنا.
                    </div>
                </div>
            `,
            "draft_report": `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold text-sky-700 mb-3">صياغة تقرير مبدئي ✨</h2>
                    <p class="mb-4">أدخل كلمات مفتاحية أو وصفاً موجزاً لسيناريو حادثة، وسيقوم النموذج بصياغة هيكل تقرير مبدئي أو نقاط رئيسية لتقرير شرطة.</p>
                    <div class="mb-4">
                        <label for="report-incident-input" class="block text-slate-700 text-sm font-bold mb-2">وصف الحادثة (كلمات مفتاحية أو موجز):</label>
                        <textarea id="report-incident-input" class="shadow appearance-none border rounded w-full py-2 px-3 text-slate-700 leading-tight focus:outline-none focus:shadow-outline focus:ring-sky-500 focus:border-sky-500 h-40" placeholder="مثال: سرقة بقالة، مشتبه به يهرب على الأقدام، استخدام التيزر."></textarea>
                    </div>
                    <div class="mb-4 flex items-center">
                        <button id="generate-report-btn" class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-colors">
                            صياغة التقرير ✨
                        </button>
                        <span id="report-loading-indicator" class="hidden text-slate-600 text-sm mr-2">
                            <span class="loading-spinner"></span> جاري الصياغة...
                        </span>
                    </div>
                    <div id="report-output" class="bg-slate-50 p-4 rounded-md border border-slate-200 min-h-[100px] text-slate-800 whitespace-pre-wrap">
                        التقرير المبدئي سيظهر هنا.
                    </div>
                </div>
            `
        };
        
        const tocNav = document.getElementById('toc-nav');
        const contentArea = document.getElementById('content-area');
        const sectionSearchInput = document.getElementById('section-search-input');
        const globalSearchInput = document.getElementById('global-search-input');
        const globalSearchResultsDiv = document.getElementById('global-search-results');
        const globalResultsList = document.getElementById('global-results-list');
        const clearGlobalSearchBtn = document.getElementById('clear-global-search');
        const menuToggleButton = document.getElementById('menu-toggle-btn');
        const sidebar = document.getElementById('sidebar');
        const closeSidebarButton = document.getElementById('close-sidebar-btn');

        let currentSectionId = toc[0].id;
        let originalContent = {}; // لتخزين المحتوى الأصلي لإعادة تعيين البحث

        function showSection(sectionId) {
            currentSectionId = sectionId;
            // إزالة أي تمييزات سابقة من جميع الأقسام
            for (const key in originalContent) {
                const sectionDiv = document.getElementById(key);
                if (sectionDiv) {
                    sectionDiv.innerHTML = originalContent[key];
                    sectionDiv.querySelectorAll('.accordion').forEach(createAccordion); // Re-initialize accordions
                }
            }
            // مسح البحث المحلي
            sectionSearchInput.value = '';

            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            const activeSection = document.getElementById(sectionId);
            if (activeSection) {
                activeSection.classList.add('active');
                // تخزين المحتوى الأصلي إذا لم يكن مخزناً بالفعل (أو تحديثه عند التبديل)
                if (!originalContent[sectionId]) {
                    originalContent[sectionId] = activeSection.innerHTML;
                }
            }

            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.section === sectionId) {
                    link.classList.add('active');
                }
            });
            
            // معالجة خاصة لقسم المخططات
            if (sectionId === 's2_1') {
                setTimeout(initRobberyChart, 0); // التأكد من أن الكانفاس مرئي
            }
            // معالجة خاصة لأقسام LLM
            if (sectionId === 'training_questions') {
                populateQuestionSections();
            }


            // إخفاء الشريط الجانبي على الجوال بعد الاختيار
            if (window.innerWidth < 768) {
                sidebar.classList.add('-translate-x-full');
            }
            // مسح نتائج البحث العام
            globalSearchInput.value = '';
            globalSearchResultsDiv.classList.add('hidden');
            globalResultsList.innerHTML = '';
        }

        function createAccordion(element) {
            const button = element.querySelector('.accordion-button');
            const content = element.querySelector('.accordion-content');
            if (button && content) {
                button.addEventListener('click', () => {
                    content.classList.toggle('hidden');
                    button.classList.toggle('open');
                });
            }
        }
        
        function initRobberyChart() {
            const chartCanvas = document.getElementById('robberyStaffingChart');
            if (!chartCanvas) return;
            if (chartCanvas.chart) { // تدمير المخطط الموجود إن وجد
                chartCanvas.chart.destroy();
            }

            const data = {
                labels: [
                    "سرقة بقالة", "سرقة منزل", "سرقة الكاش", "سرقة الديجتال", 
                    "سرقة سيارة البنك", "سرقة المصرف", "سرقة المكيفات", 
                    "سرقة الغسالات", "سرقة المجوهرات", "سرقة المتحف", 
                    "سرقة البوبكات", "سرقة المجوهرات الكبيرة", "سرقة الميز بنك"
                ],
                datasets: [
                    {
                        label: 'الحد الأدنى للشرطة',
                        data: [2, 3, 5, 4, 5, 4, 4, 5, 5, 6, 9, 6, 7],
                        backgroundColor: 'rgba(54, 162, 235, 0.6)', // أزرق
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'الحد الأقصى للشرطة',
                        data: [4, 5, 8, 6, 9, 8, 8, 7, 8, 12, 11, 13, 16],
                        backgroundColor: 'rgba(255, 99, 132, 0.6)', // أحمر
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }
                ]
            };
            const config = {
                type: 'bar',
                data: data,
                options: {
                    indexAxis: 'y', // مخطط شريطي أفقي
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: { color: '#334155' }, // slate-700
                            grid: { color: '#e2e8f0' } // slate-200
                        },
                        y: {
                            ticks: { color: '#334155', font: { size: 10 } },
                             grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: { color: '#334155' }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            titleFont: { weight: 'bold'},
                            bodyFont: { size: 12 },
                            callbacks: {
                                title: function(tooltipItems) {
                                    return tooltipItems[0].label;
                                }
                            }
                        }
                    }
                }
            };
            chartCanvas.chart = new Chart(chartCanvas, config);
        }

        let sectionHighlightTimeout;
        sectionSearchInput.addEventListener('input', () => {
            clearTimeout(sectionHighlightTimeout);
            sectionHighlightTimeout = setTimeout(performSectionSearch, 300);
        });

        function performSectionSearch() {
            const searchTerm = sectionSearchInput.value.trim().toLowerCase();
            const activeSectionDiv = document.getElementById(currentSectionId);

            if (!activeSectionDiv || !originalContent[currentSectionId]) return;

            // Restore original content before new search
            activeSectionDiv.innerHTML = originalContent[currentSectionId];
            
            // Re-initialize accordions if any were in the original content
            activeSectionDiv.querySelectorAll('.accordion').forEach(createAccordion);
            // Re-initialize chart if it's the chart section
            if (currentSectionId === 's2_1') {
                 setTimeout(initRobberyChart, 0);
            }

            if (searchTerm === '') {
                return; // No search term, original content is already restored
            }

            const textNodes = [];
            function getTextNodes(node) {
                if (node.nodeType === Node.TEXT_NODE) {
                    if (node.nodeValue.trim() !== '') {
                         // Avoid highlighting script/style content if any were accidentally included
                        if (node.parentNode.nodeName !== 'SCRIPT' && node.parentNode.nodeName !== 'STYLE') {
                            textNodes.push(node);
                        }
                    }
                } else {
                    for (const childNode of node.childNodes) {
                        // Do not recurse into canvas or its container
                        if (node.id === 'robberyStaffingChart' || node.classList.contains('chart-container')) continue;
                        getTextNodes(childNode);
                    }
                }
            }

            getTextNodes(activeSectionDiv);
            
            let firstHighlightFound = false;
            textNodes.forEach(node => {
                const text = node.nodeValue;
                const lowerText = text.toLowerCase();
                let matchIndex = lowerText.indexOf(searchTerm);
                if (matchIndex !== -1) {
                    const fragment = document.createDocumentFragment();
                    let lastIndex = 0;
                    while (matchIndex !== -1) {
                        // Add text before match
                        fragment.appendChild(document.createTextNode(text.substring(lastIndex, matchIndex)));
                        // Add highlighted match
                        const mark = document.createElement('mark');
                        mark.textContent = text.substring(matchIndex, matchIndex + searchTerm.length);
                        fragment.appendChild(mark);
                        
                        if (!firstHighlightFound) {
                            mark.id = 'first-highlight-occurrence'; // Mark the first one for scrolling
                            firstHighlightFound = true;
                        }

                        lastIndex = matchIndex + searchTerm.length;
                        matchIndex = lowerText.indexOf(searchTerm, lastIndex);
                    }
                    // Add text after last match
                    fragment.appendChild(document.createTextNode(text.substring(lastIndex)));
                    node.parentNode.replaceChild(fragment, node);
                }
            });

            // Scroll to the first highlighted occurrence
            if (firstHighlightFound) {
                document.getElementById('first-highlight-occurrence').scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        let globalSearchTimeout;
        globalSearchInput.addEventListener('input', () => {
            clearTimeout(globalSearchTimeout);
            globalSearchTimeout = setTimeout(performGlobalSearch, 300);
        });

        clearGlobalSearchBtn.addEventListener('click', () => {
            globalSearchInput.value = '';
            globalSearchResultsDiv.classList.add('hidden');
            globalResultsList.innerHTML = '';
            // Clear highlights from all sections
            for (const key in originalContent) {
                const sectionDiv = document.getElementById(key);
                if (sectionDiv) {
                    sectionDiv.innerHTML = originalContent[key];
                    sectionDiv.querySelectorAll('.accordion').forEach(createAccordion); // Re-initialize accordions
                }
            }
            // Re-initialize chart if it's the chart section
            if (currentSectionId === 's2_1') {
                 setTimeout(initRobberyChart, 0);
            }
        });

        function performGlobalSearch() {
            const searchTerm = globalSearchInput.value.trim().toLowerCase();
            globalResultsList.innerHTML = ''; // Clear previous results

            if (searchTerm === '') {
                globalSearchResultsDiv.classList.add('hidden');
                // Clear highlights from all sections
                for (const key in originalContent) {
                    const sectionDiv = document.getElementById(key);
                    if (sectionDiv) {
                        sectionDiv.innerHTML = originalContent[key];
                        sectionDiv.querySelectorAll('.accordion').forEach(createAccordion); // Re-initialize accordions
                    }
                }
                // Re-initialize chart if it's the chart section
                if (currentSectionId === 's2_1') {
                     setTimeout(initRobberyChart, 0);
                }
                return;
            }

            let resultsFound = false;
            for (const sectionItem of toc) {
                const sectionId = sectionItem.id;
                const sectionTitle = sectionItem.title;
                const sectionContent = contentData[sectionId]; // Get raw HTML content

                if (!sectionContent) continue;

                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = sectionContent;
                const textContent = tempDiv.textContent || tempDiv.innerText;

                const lowerTextContent = textContent.toLowerCase();
                let matchIndex = lowerTextContent.indexOf(searchTerm);

                if (matchIndex !== -1) {
                    resultsFound = true;
                    const listItem = document.createElement('li');
                    const link = document.createElement('a');
                    link.href = '#';
                    link.classList.add('text-blue-600', 'hover:underline', 'cursor-pointer', 'block');
                    
                    // Create snippet
                    const snippetStart = Math.max(0, matchIndex - 50); // 50 chars before
                    const snippetEnd = Math.min(textContent.length, matchIndex + searchTerm.length + 50); // 50 chars after
                    let snippet = textContent.substring(snippetStart, snippetEnd);
                    
                    // Add ellipsis if snippet is not from start/end of text
                    if (snippetStart > 0) snippet = '...' + snippet;
                    if (snippetEnd < textContent.length) snippet = snippet + '...';

                    // Highlight term in snippet for display
                    const highlightedSnippet = snippet.replace(new RegExp(searchTerm, 'gi'), (match) => `<mark>${match}</mark>`);

                    link.innerHTML = `<strong>${sectionTitle}:</strong> ${highlightedSnippet}`;
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        showSection(sectionId); // Navigate to the section
                        sectionSearchInput.value = searchTerm; // Populate local search
                        performSectionSearch(); // Trigger local highlight and scroll
                    });
                    listItem.appendChild(link);
                    globalResultsList.appendChild(listItem);
                }
            }

            if (resultsFound) {
                globalSearchResultsDiv.classList.remove('hidden');
            } else {
                globalSearchResultsDiv.classList.add('hidden');
                const listItem = document.createElement('li');
                listItem.textContent = 'لا توجد نتائج مطابقة.';
                globalResultsList.appendChild(listItem);
            }
        }
        
        menuToggleButton.addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
        });
        closeSidebarButton.addEventListener('click', () => {
            sidebar.classList.add('-translate-x-full');
        });

        // دالة لاستخراج النص النظيف من محتوى HTML
        function getCleanTextFromHtml(htmlString) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = htmlString;
            return tempDiv.textContent || tempDiv.innerText || "";
        }

        // وظيفة استدعاء Gemini API
        async function callGeminiAPI(apiType) {
            const queryInput = (apiType === 'consultation') ? document.getElementById('llm-query-input') : 
                               (apiType === 'scenario') ? document.getElementById('scenario-input') :
                               (apiType === 'questions') ? document.getElementById('question-section-select') :
                               (apiType === 'report') ? document.getElementById('report-incident-input') : null;

            const responseOutput = (apiType === 'consultation') ? document.getElementById('llm-response-output') : 
                                   (apiType === 'scenario') ? document.getElementById('scenario-response-output') :
                                   (apiType === 'questions') ? document.getElementById('questions-output') :
                                   (apiType === 'report') ? document.getElementById('report-output') : null;

            const loadingIndicator = (apiType === 'consultation') ? document.getElementById('llm-loading-indicator') : 
                                     (apiType === 'scenario') ? document.getElementById('scenario-loading-indicator') :
                                     (apiType === 'questions') ? document.getElementById('questions-loading-indicator') :
                                     (apiType === 'report') ? document.getElementById('report-loading-indicator') : null;
            
            const submitButton = (apiType === 'consultation') ? document.getElementById('llm-submit-btn') : 
                                 (apiType === 'scenario') ? document.getElementById('scenario-submit-btn') :
                                 (apiType === 'questions') ? document.getElementById('generate-questions-btn') :
                                 (apiType === 'report') ? document.getElementById('generate-report-btn') : null;

            let userQuery = "";
            let relevantContent = "";

            if (apiType === 'questions') {
                const selectedSectionId = queryInput.value;
                relevantContent = getCleanTextFromHtml(contentData[selectedSectionId]);
                userQuery = `اقتراح 3-5 أسئلة تدريبية (اختيار من متعدد أو إجابة قصيرة) بناءً على محتوى القسم "${queryInput.options[queryInput.selectedIndex].text}".`;
                if (!relevantContent.trim()) {
                    responseOutput.textContent = "عذراً، هذا القسم لا يحتوي على محتوى كافٍ لتوليد الأسئلة.";
                    return;
                }
            } else if (apiType === 'report') {
                userQuery = queryInput.value.trim();
                relevantContent = getCleanTextFromHtml(contentData['s1_3']) + "\n" + getCleanTextFromHtml(contentData['s1_5']); // آلية التعامل مع الحالات الجنائية وانضباط الشرطة
                if (!userQuery) {
                    responseOutput.textContent = "الرجاء إدخال وصف للحادثة.";
                    return;
                }
            } else { // consultation or scenario
                userQuery = queryInput.value.trim();
                if (!userQuery) {
                    responseOutput.textContent = "الرجاء إدخال استفسارك.";
                    return;
                }
            }

            loadingIndicator.classList.remove('hidden');
            submitButton.disabled = true;
            responseOutput.textContent = ""; // مسح الرد السابق

            try {
                let fullBookletContent = "";
                for (const key in contentData) {
                    if (contentData.hasOwnProperty(key)) {
                        fullBookletContent += getCleanTextFromHtml(contentData[key]) + "\n\n";
                    }
                }

                let prompt = "";
                if (apiType === 'consultation') {
                    prompt = `أنت خبير في كتيب إجراءات التشغيل القياسية لشرطة سان أندرياس.
                    **القواعد الهامة للإجابة:**
                    1.  **أجب فقط بناءً على المعلومات المتوفرة في الكتيب التالي.**
                    2.  **إذا كانت إجابة سؤال المستخدم غير موجودة أو غير واضحة في الكتيب، فأجب في سياق لعبة FiveM أو Grand Theft Auto (الحياة الواقعية).**
                    3.  اجابتك يجب أن تكون موجزة ومباشرة، ومرتبطة بإجراءات الشرطة.

                    **محتوى الكتيب:**
                    ${fullBookletContent}

                    **سؤال المستخدم:**
                    ${userQuery}`;
                } else if (apiType === 'scenario') {
                    prompt = `أنت مدرب شرطة خبير في إجراءات التشغيل القياسية لشرطة سان أندرياس.
                    **القواعد الهامة للتحليل:**
                    1.  **قدم مسار عمل مقترح خطوة بخطوة بناءً على المعلومات المتوفرة في الكتيب التالي.**
                    2.  **إذا كانت الإجراءات غير موجودة أو غير واضحة في الكتيب، فاستخدم معرفتك بسياق لعبة FiveM أو Grand Theft Auto (الحياة الواقعية) لتقديم أفضل توجيه.**
                    3.  يجب أن يكون التحليل موجزاً، عملياً، ومرتبطاً بإجراءات الشرطة.

                    **محتوى الكتيب:**
                    ${fullBookletContent}

                    **السيناريو:**
                    ${userQuery}`;
                } else if (apiType === 'questions') {
                    prompt = `أنت خبير في صياغة أسئلة تدريبية لكتيب إجراءات الشرطة.
                    **القواعد الهامة لتوليد الأسئلة:**
                    1.  **بناءً على المحتوى التالي من الكتيب، قم بتوليد 3-5 أسئلة تدريبية.**
                    2.  يمكن أن تكون الأسئلة اختيار من متعدد أو أسئلة إجابة قصيرة.
                    3.  يجب أن تتضمن الأسئلة إجاباتها الصحيحة بوضوح.
                    4.  يجب أن تكون الأسئلة ذات صلة مباشرة بمحتوى القسم المحدد.

                    **محتوى القسم المحدد من الكتيب:**
                    ${relevantContent}

                    **الطلب:**
                    ${userQuery}`;
                } else if (apiType === 'report') {
                     prompt = `أنت خبير في صياغة تقارير الشرطة ضمن سياق كتيب إجراءات التشغيل القياسية لشرطة سان أندرياس.
                    **القواعد الهامة لصياغة التقرير:**
                    1.  **بناءً على وصف الحادثة والكتيب، قم بصياغة هيكل تقرير مبدئي أو نقاط رئيسية لتقرير شرطة.**
                    2.  ركز على الأقسام ذات الصلة مثل "آلية التعامل مع الحالات الجنائية" و "انضباط الشرطة".
                    3.  إذا لم تكن الإجراءات محددة في الكتيب، استخدم أفضل الممارسات العامة لصياغة تقارير الشرطة في سياق لعبة FiveM/Grand Theft Auto (الحياة الواقعية).
                    4.  يجب أن يكون التقرير موجزاً، منظماً، وعملياً.

                    **محتوى الكتيب ذو الصلة:**
                    ${relevantContent}

                    **وصف الحادثة:**
                    ${userQuery}`;
                }


                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = { contents: chatHistory };
                const apiKey = "AIzaSyBmgwfd6KlrPbzN4H85jeB1NBupAqdHzAM"; // <--- ضع مفتاح API الخاص بك هنا
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    responseOutput.textContent = result.candidates[0].content.parts[0].text;
                } else {
                    responseOutput.textContent = "عذراً، لم أتمكن من الحصول على رد. يرجى المحاولة مرة أخرى.";
                    console.error("Gemini API response structure unexpected:", result);
                }
            } catch (error) {
                responseOutput.textContent = "حدث خطأ أثناء الاتصال بالنموذج. يرجى التحقق من اتصالك بالإنترنت والمحاولة مرة أخرى.";
                console.error("Error calling Gemini API:", error);
            } finally {
                loadingIndicator.classList.add('hidden');
                submitButton.disabled = false;
            }
        }


        // التهيئة
        toc.forEach(item => {
            // إنشاء روابط الشريط الجانبي
            const link = document.createElement('a');
            link.href = '#';
            link.textContent = item.title;
            link.dataset.section = item.id;
            link.classList.add('block', 'p-2', 'rounded-md', 'hover:bg-sky-700', 'transition-colors', 'sidebar-link');
            link.addEventListener('click', (e) => {
                e.preventDefault();
                showSection(item.id);
            });
            tocNav.appendChild(link);

            // إنشاء أقسام المحتوى
            const sectionDiv = document.createElement('div');
            sectionDiv.id = item.id;
            sectionDiv.classList.add('content-section', 'prose', 'prose-slate', 'max-w-none');
            // إزالة أنماط prose من حاوية المخطط لتجنب التعارضات
            if (item.id === 's2_1') {
                sectionDiv.classList.remove('prose', 'prose-slate');
            }
            sectionDiv.innerHTML = contentData[item.id]; // Initial content load
            contentArea.appendChild(sectionDiv);
            
            // Store original content for all sections during initialization
            originalContent[item.id] = sectionDiv.innerHTML;

            // تهيئة الأكورديونات داخل هذا القسم
            sectionDiv.querySelectorAll('.accordion').forEach(createAccordion);
        });

        // Populate question section select dropdown
        function populateQuestionSections() {
            const selectElement = document.getElementById('question-section-select');
            if (selectElement) {
                selectElement.innerHTML = ''; // Clear existing options
                toc.forEach(item => {
                    // Exclude intro and LLM features from question generation
                    if (item.id !== 'intro' && item.id !== 'llm_consultation' && item.id !== 'scenario_analysis' && item.id !== 'training_questions' && item.id !== 'draft_report') {
                        const option = document.createElement('option');
                        option.value = item.id;
                        option.textContent = item.title;
                        selectElement.appendChild(option);
                    }
                });
            }
        }


        showSection(toc[0].id); // عرض القسم الأول افتراضياً

        // ربط زر الاستشارة السريعة بوظيفة استدعاء LLM
        document.getElementById('llm-submit-btn').addEventListener('click', () => callGeminiAPI('consultation'));
        // ربط زر تحليل السيناريو بوظيفة استدعاء LLM
        document.getElementById('scenario-submit-btn').addEventListener('click', () => callGeminiAPI('scenario'));
        // ربط زر توليد الأسئلة
        document.getElementById('generate-questions-btn').addEventListener('click', () => callGeminiAPI('questions'));
        // ربط زر صياغة التقرير
        document.getElementById('generate-report-btn').addEventListener('click', () => callGeminiAPI('report'));

    </script>
</body>
</html>
